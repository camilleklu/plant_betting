{% extends 'base.html' %}

{% block content %}
<section class="min-h-[calc(100vh-200px)] bg-gradient-to-b from-emerald-50 to-white pt-0"> <!-- Ajout de pt-0 -->
    <!-- En-t√™te avec d√©grad√© -->
    <div class="bg-gradient-to-r from-emerald-600 via-green-500 to-emerald-600 text-white py-12 pt-16"> <!-- Ajout de pt-16 -->
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="w-24 h-24 mx-auto mb-6 bg-white/20 backdrop-blur-sm rounded-3xl flex items-center justify-center">
                <i class="fas fa-trophy text-5xl text-yellow-300"></i>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold mb-4">üèÜ Classement G√©n√©ral</h1>
            <p class="text-xl text-emerald-100 max-w-3xl mx-auto">
                Les meilleurs jardiniers-parieurs de Paris Plantes
            </p>
            
            <!-- Votre position -->
            {% if user.is_authenticated %}
            <div class="mt-8 inline-flex items-center gap-4 bg-white/20 backdrop-blur-sm px-6 py-3 rounded-full">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-emerald-500 to-green-500 rounded-full flex items-center justify-center">
                        <span class="font-bold text-white">{{ user_rank }}</span>
                    </div>
                    <div class="text-left">
                        <div class="text-sm text-emerald-200">Votre position</div>
                        <div class="font-bold text-lg">{{ user.username }}</div>
                    </div>
                </div>
                <div class="h-8 w-px bg-white/30"></div>
                <div class="text-left">
                    <div class="text-sm text-emerald-200">Vos points</div>
                    <div class="font-bold text-lg text-yellow-300">{{ user_points|default:"0" }} pts</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Tableau de classement -->
    <div class="max-w-7xl mx-auto px-4 py-8 -mt-4"> <!-- Ajout de -mt-4 -->
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden border border-emerald-100">
            <!-- En-t√™te du tableau -->
            <div class="bg-gradient-to-r from-gray-50 to-emerald-50 px-6 py-4 border-b border-gray-200">
                <div class="grid grid-cols-12 gap-4">
                    <div class="col-span-1 text-center">
                        <span class="text-sm font-semibold text-gray-700">RANG</span>
                    </div>
                    <div class="col-span-5">
                        <span class="text-sm font-semibold text-gray-700">JOUEUR</span>
                    </div>
                    <div class="col-span-2 text-center">
                        <span class="text-sm font-semibold text-gray-700">PARIS</span>
                    </div>
                    <div class="col-span-2 text-center">
                        <span class="text-sm font-semibold text-gray-700">POINTS</span>
                    </div>
                    <div class="col-span-2 text-center">
                        <span class="text-sm font-semibold text-gray-700">TAUX DE R√âUSSITE</span>
                    </div>
                </div>
            </div>

            <!-- Liste des joueurs -->
            <div class="divide-y divide-gray-100">
                {% for score in leaders %}
                <div class="group {% if score.user == user %}bg-gradient-to-r from-emerald-50 to-green-50 border-l-4 border-emerald-500{% endif %} 
                            hover:bg-emerald-50/50 transition-all duration-300">
                    <div class="px-6 py-4">
                        <div class="grid grid-cols-12 gap-4 items-center">
                            <!-- Rang -->
                            <div class="col-span-1 text-center">
                                {% if forloop.counter == 1 %}
                                <div class="relative">
                                    <div class="w-10 h-10 mx-auto bg-gradient-to-r from-yellow-400 to-amber-500 rounded-full flex items-center justify-center shadow-lg">
                                        <i class="fas fa-crown text-white text-lg"></i>
                                    </div>
                                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-yellow-500 rounded-full flex items-center justify-center text-xs font-bold text-white">
                                        1
                                    </div>
                                </div>
                                {% elif forloop.counter == 2 %}
                                <div class="relative">
                                    <div class="w-10 h-10 mx-auto bg-gradient-to-r from-gray-300 to-gray-400 rounded-full flex items-center justify-center shadow-lg">
                                        <i class="fas fa-medal text-white text-lg"></i>
                                    </div>
                                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-gray-400 rounded-full flex items-center justify-center text-xs font-bold text-white">
                                        2
                                    </div>
                                </div>
                                {% elif forloop.counter == 3 %}
                                <div class="relative">
                                    <div class="w-10 h-10 mx-auto bg-gradient-to-r from-amber-700 to-orange-600 rounded-full flex items-center justify-center shadow-lg">
                                        <i class="fas fa-medal text-white text-lg"></i>
                                    </div>
                                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-amber-600 rounded-full flex items-center justify-center text-xs font-bold text-white">
                                        3
                                    </div>
                                </div>
                                {% else %}
                                <div class="w-10 h-10 mx-auto bg-gray-100 group-hover:bg-emerald-100 rounded-full flex items-center justify-center transition-colors duration-300">
                                    <span class="font-bold {% if score.user == user %}text-emerald-700{% else %}text-gray-600{% endif %}">
                                        {{ forloop.counter }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Joueur -->
                            <div class="col-span-5">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-gradient-to-r 
                                        {% if forloop.counter == 1 %}from-yellow-100 to-amber-100
                                        {% elif forloop.counter == 2 %}from-gray-100 to-gray-200
                                        {% elif forloop.counter == 3 %}from-amber-100 to-orange-100
                                        {% elif score.user == user %}from-emerald-100 to-green-100
                                        {% else %}from-blue-100 to-indigo-100{% endif %}
                                        rounded-xl flex items-center justify-center shadow-sm">
                                        <span class="text-xl font-bold 
                                            {% if forloop.counter == 1 %}text-amber-700
                                            {% elif forloop.counter == 2 %}text-gray-700
                                            {% elif forloop.counter == 3 %}text-orange-700
                                            {% elif score.user == user %}text-emerald-700
                                            {% else %}text-blue-700{% endif %}">
                                            {{ score.user.username|first|upper }}
                                        </span>
                                    </div>
                                    <div>
                                        <div class="flex items-center gap-2">
                                            <h3 class="font-bold text-gray-800 group-hover:text-emerald-700 transition-colors duration-300">
                                                {{ score.user.username }}
                                            </h3>
                                            {% if score.user == user %}
                                            <span class="bg-emerald-500 text-white text-xs px-2 py-0.5 rounded-full">
                                                VOUS
                                            </span>
                                            {% endif %}
                                        </div>
                                        <p class="text-sm text-gray-500 mt-1">
                                            Membre depuis {{ score.user.date_joined|date:"M Y"|default:"r√©cemment" }}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Nombre de paris -->
                            <div class="col-span-2 text-center">
                                <div class="flex flex-col items-center">
                                    <div class="w-10 h-10 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg flex items-center justify-center mb-1">
                                        <i class="fas fa-coins text-blue-500"></i>
                                    </div>
                                    <span class="font-bold text-gray-800">
                                        {{ score.total_bets|default:"0" }}
                                    </span>
                                    <span class="text-xs text-gray-500">paris</span>
                                </div>
                            </div>

                            <!-- Points -->
                            <div class="col-span-2 text-center">
                                <div class="flex flex-col items-center">
                                    <div class="w-10 h-10 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg flex items-center justify-center mb-1">
                                        <i class="fas fa-star text-amber-500"></i>
                                    </div>
                                    <span class="font-bold text-2xl 
                                        {% if forloop.counter == 1 %}text-yellow-500
                                        {% elif forloop.counter == 2 %}text-gray-500
                                        {% elif forloop.counter == 3 %}text-amber-600
                                        {% else %}text-emerald-600{% endif %}">
                                        {{ score.total_points }}
                                    </span>
                                    <span class="text-xs text-gray-500">points</span>
                                </div>
                            </div>

                            <!-- Taux de r√©ussite -->
                            <div class="col-span-2 text-center">
                                <div class="flex flex-col items-center">
                                    <div class="relative w-full max-w-32 mx-auto">
                                        <div class="w-16 h-16 mx-auto mb-2">
                                            <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                                <path class="text-gray-200"
                                                    d="M18 2.0845
                                                    a 15.9155 15.9155 0 0 1 0 31.831
                                                    a 15.9155 15.9155 0 0 1 0 -31.831"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    stroke-width="3"
                                                    stroke-dasharray="100, 100"
                                                />
                                                <path class="
                                                    {% if score.accuracy_rate >= 80 %}text-emerald-500
                                                    {% elif score.accuracy_rate >= 60 %}text-blue-500
                                                    {% elif score.accuracy_rate >= 40 %}text-amber-500
                                                    {% else %}text-red-500{% endif %}"
                                                    d="M18 2.0845
                                                    a 15.9155 15.9155 0 0 1 0 31.831
                                                    a 15.9155 15.9155 0 0 1 0 -31.831"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    stroke-width="3"
                                                    stroke-dasharray="{{ score.accuracy_rate|default:0 }}, 100"
                                                    stroke-linecap="round"
                                                />
                                            </svg>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span class="font-bold text-sm
                                                    {% if score.accuracy_rate >= 80 %}text-emerald-600
                                                    {% elif score.accuracy_rate >= 60 %}text-blue-600
                                                    {% elif score.accuracy_rate >= 40 %}text-amber-600
                                                    {% else %}text-red-600{% endif %}">
                                                    {{ score.accuracy_rate|floatformat:0 }}%
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="text-xs text-gray-500">pr√©cision</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<!-- Style pour les graphiques circulaires -->
<style>
    .progress-ring {
        transition: stroke-dasharray 0.5s ease;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .animate-fade-in-up {
        animation: fadeInUp 0.5s ease-out forwards;
    }
    
    .row-delay-1 { animation-delay: 0.1s; }
    .row-delay-2 { animation-delay: 0.2s; }
    .row-delay-3 { animation-delay: 0.3s; }
    .row-delay-4 { animation-delay: 0.4s; }
    .row-delay-5 { animation-delay: 0.5s; }
    
    /* Correction sp√©cifique pour √©viter l'espace blanc */
    .sticky-nav-fix {
        position: relative;
        z-index: 40;
    }
</style>

<!-- Script pour les animations -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Ajouter des animations aux lignes du classement
        const rows = document.querySelectorAll('.divide-y > div');
        rows.forEach((row, index) => {
            row.classList.add('animate-fade-in-up');
            if (index < 5) {
                row.classList.add(`row-delay-${index + 1}`);
            }
        });
        
        // Animation des cercles de progression
        const circles = document.querySelectorAll('.progress-ring');
        circles.forEach(circle => {
            const percentage = parseFloat(circle.getAttribute('data-percentage') || 0);
            const circumference = 2 * Math.PI * 15.9155;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
        });
    });
    
    // Correction pour l'espace blanc au survol
    document.addEventListener('scroll', function() {
        const nav = document.querySelector('nav');
        const header = document.querySelector('.bg-gradient-to-r.from-emerald-600');
        
        if (window.scrollY > 50) {
            nav.classList.add('sticky-nav-fix');
        } else {
            nav.classList.remove('sticky-nav-fix');
        }
    });
</script>
{% endblock %}